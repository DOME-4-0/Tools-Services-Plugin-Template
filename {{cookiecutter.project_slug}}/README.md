# FastAPI/Python Service
This project has been created using the [DOME 4.0 Tools and Services Plugin Template](https://github.com/DOME-4-0/Tools-Services-Plugin-Template),
and is based on on SINTEF's [Fastapi Template](https://github.com/SINTEF/fastapi-template).

## Deployment

Once the wrapper is modified and ready to be registered with DOME4.0 it should have a permanent, publicly available URL from which the wrapper can be reached.

1. Register the Tool/service

During registration you will get a ´client_id´ ´client_secret´ . Please store it temporarily for the next step.

2. Build and deploy the wrapper

Please make sure that the wrapper is accessible publicly (i.e. findable but secure) 
Next, you need to define your own values via environment values to include client_id and client_secret generated by the DOME4.0 


### Docker deployment steps

´docker-compose up -d´


## Run in Docker
### Development target
The development target will allow for automatic reloading when source code changes. This requires that the local directory is bind-mounted using the -v or --volume argument. To Build and run the development target from the command line:


	docker build --rm -q -f Dockerfile \
	  --label "dome.fastservice-target=development" \
	  --target development \
	  -t "dome/fastservice-development:latest" .
	  
	docker run --rm -i --user="$(id -u):$(id -g)" -p 8000:8000 -v "$PWD:/app" dome/fastservice-development:latest

Open http://localhost:8000 on your browser to test the application.

### Production target
The production target will not reload itself on code change and will run a predictable version of the code on port 80. Also you might want to use a named container with the --restart=always option to ensure that the container is restarted indefinitely regardless of the exit status. To build and run the production target from the command line:


	docker build --rm -q -f Dockerfile \
	  --label "dome.fastservice-target=production" \
	  --target production \
	  -t "dome/fastservice-production:latest" .
	  
	docker run -d -p 8000:8000 --user="$(id -u):$(id -g)" --name fastservice --restart=always dome/fastservice-production:latest
